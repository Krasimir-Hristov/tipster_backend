# План за действие: AI Футболен Анализатор (Backend)

Този документ описва стъпките за изграждане на backend частта на AI футболния анализатор. Ще използваме Django за API и LangGraph за оркестрация на LLM агентите.

---

### Фаза 1: Настройка на проекта и основна структура на Django

- [ ] **Стъпка 1.1: Инициализация на Python среда и зависимости**
    - [ ] Създаване на виртуална среда (`.venv`).
    - [ ] Активиране на виртуалната среда.
    - [ ] Създаване на `requirements.txt` с необходимите пакети.
    - [ ] Инсталиране на пакетите с `pip install -r requirements.txt`.

- [ ] **Стъпка 1.2: Създаване на Django проект и приложение**
    - [ ] Генериране на Django проект с име `tipster_project`.
    - [ ] Генериране на Django приложение с име `api`.
    - [ ] Добавяне на `rest_framework` и `api` приложението в `INSTALLED_APPS` в `settings.py`.

- [ ] **Стъпка 1.3: Конфигуриране на API ендпойнт**
    - [ ] Създаване на `urls.py` в `api` приложението.
    - [ ] Дефиниране на основен URL ендпойнт `/api/analyze/` в `api/urls.py`.
    - [ ] Включване на `api/urls.py` в главния `tipster_project/urls.py`.
    - [ ] Създаване на празна View функция в `api/views.py`, която ще обработва заявките.

---

### Фаза 2: Разработка на ядрото на AI агента с LangGraph

- [ ] **Стъпка 2.1: Дефиниране на състоянието (State) на графа**
    - [ ] Създаване на Python клас/TypedDict, който да описва данните, които се движат през графа (имена на отбори, събрана информация, анализи на малките модели).

- [ ] **Стъпка 2.2: Инструмент за събиране на данни (Web Search)**
    - [ ] Създаване на функция, която използва Tavily API за търсене на актуална информация за двата отбора (новини, контузии, форма).
    - [ ] Дефиниране на тази функция като "tool" в LangGraph.

- [ ] **Стъпка 2.3: Създаване на специализираните "анализаторски" възли (Nodes)**
    - [ ] Дефиниране на функция-възел за анализ на "Брой голове".
    - [ ] Дефиниране на функция-възел за анализ на "Победител в мача".
    - [ ] Дефиниране на функция-възел за анализ на "Точен резултат".
    - [ ] (По желание) Дефиниране на други възли (напр. ъглови удари, картони).
    - *Всяка от тези функции ще извиква евтин LLM (Gemini Flash) със силно специфичен prompt.*

- [ ] **Стъпка 2.4: Създаване на "агрегиращия" възел**
    - [ ] Дефиниране на функция-възел, която получава резултатите от всички анализатори.
    - [ ] Тази функция ще извиква мощния LLM (Gemini 2.5 Pro) с prompt, който изисква да се направи финален, обобщен анализ на базата на подадените данни.

- [ ] **Стъпка 2.5: Сглобяване на графа (Graph Assembly)**
    - [ ] Инстанциране на `StatefulGraph`.
    - [ ] Добавяне на всички дефинирани възли (nodes) към графа.
    - [ ] Дефиниране на ребрата (edges), които описват потока на информация: от началото, през събирането на данни, към паралелно изпълнение на анализаторите и накрая към агрегатора.
    - [ ] Компилиране на графа.

---

### Фаза 3: Интеграция на LangGraph с Django

- [ ] **Стъпка 3.1: Свързване на AI логиката с API View**
    - [ ] Импортиране на компилирания LangGraph граф в `api/views.py`.
    - [ ] В API View функцията, приемане на имената на отборите от POST заявка.
    - [ ] Извикване на графа с получените данни.
    - [ ] Получаване на финалния резултат от агрегаторния възел.

- [ ] **Стъпка 3.2: Форматиране и връщане на отговор**
    - [ ] Връщане на анализа от LLM-а като JSON отговор от API ендпойнта.
    - [ ] Имплементиране на базова обработка на грешки (ако нещо в процеса се провали).

---

### Фаза 4: Финални настройки и сигурност

- [ ] **Стъпка 4.1: Настройка на променливи на средата**
    - [ ] Създаване на `.env` файл в главната директория.
    - [ ] Добавяне на API ключовете (Google Gemini, Tavily) в `.env` файла.
    - [ ] Инсталиране на `python-dotenv` и конфигуриране на `settings.py` да зарежда ключовете от `.env` файла.

- [ ] **Стъпка 4.2: Тестване на цялостния поток**
    - [ ] Стартиране на Django сървъра.
    - [ ] Изпращане на тестова заявка (например с Postman или `curl`) до `/api/analyze/` с имената на два отбора.
    - [ ] Проверка дали се връща коректен JSON отговор с анализ.
